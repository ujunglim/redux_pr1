<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.1/redux.js"></script>
  </head>
  <body>
    <div id="title"></div>
    <div id="toc"></div>
    <div id="control"></div>
    <div id="content"></div>

    <script>
      // make modules
      function title() {
        document.querySelector('#title').innerHTML = `
        <header>
          <h1>Hello Web</h1>
        </header>
      `;
      }
      // Table Of Content
      function TOC() {
        let state = store.getState();
        let i = 0;
        let liTags = '';

        while(i < state.contents.length) {
          liTags = liTags + `
            <li>
              <a onclick="
                event.preventDefault();
                let action = {type:'SELECT', id:${state.contents[i].id}};
                store.dispatch(action);
                " 
                href="${state.contents[i].id}">
                ${state.contents[i].title}
              </a>
            </li>
          `
          i++;
        }

        document.querySelector('#toc').innerHTML = `
          <nav>
            <ol>${liTags}</ol>
          </nav>
        `;
      }
      function control() {
        document.querySelector('#control').innerHTML = `
          <input type="button" value="Create">
          <input type="button" value="Delete">
        `;
      }
      function content() {
        let state = store.getState();
        let i = 0;
        let aTitle, aDesc;

        while(i < state.contents.length) {

          if(state.contents[i].id === state.selected_id) {
            aTitle = state.contents[i].title;
            aDesc = state.contents[i].desc;
            break;
          }
          i++;
        }
        document.querySelector('#content').innerHTML = `
        <article>
          <h2>${aTitle}</h2>
          ${aDesc}
        </article>
        `;
      }
      
      //======================= Redux ===============================
      function reducer(state, action) {
        // set initial state
        if(state === undefined) {
          return {
            selected_id: 1,
            contents: [
              {id: 1, title: 'HTML', desc: 'HTML is...'},
              {id: 2, title: 'CSS', desc: 'CSS is...'}
            ]
          }
        }
        
        let newState;
        if(action.type === 'SELECT') {
          newState = Object.assign({}, state, {selected_id: action.id});
        }
        return newState;
      }
      const store = Redux.createStore(
          reducer,
          window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()    
      );
      // when state changes, automatically call content func
      store.subscribe(content)

      title();
      TOC();
      control();
      content();
    </script>
  </body>
</html>